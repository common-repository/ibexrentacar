<?php
/*
Plugin Name: Ibexrentacar
Plugin URI: http://www.ibexrentacar.com/
Description: Plugin de WordPress para conectar tu blog con la plataforma de gestión de Ibexrentacar.
Version: 1.7
Author: Ibexestudio
Author URI: http://www.ibexrentacar.com
*/
?>
<form method="post" action="options.php"><div class="postbox"> <div class="inside"> <div id="irc_sincronizecat_load" style="display:none"> <div align="center"> <br /><img src="<?php  echo $GLOBALS['lsPluginPath'].'/img/pircloading.gif' ?>" width="100" /><br /><br /> <?php  echo _irct("Espere por favor, sincronizando flota").'...'; ?><br /><br /></div></div> <div id="irc_sincronizecat_box"> <div class="ircpright" style="margin-top:5px;"> <?php  foreach($this->wplanguages as $lang => $code){ ?> <div class="ircpleft" style="padding-right:5px;"> <a onclick="ircCatImportbyLanguage('<?php  echo $code['code'] ?>')" style="text-decoration: none"> <div id="ircp_langbutton_<?php  echo $code['code']?>" class="ircp_langbutton<?php  if($code['code']==$this->wplang){?><?php  echo "_active";?><?php  }?>"> <div class="ircp_langbuttonContent"> <?php  if(isset($code['country_flag_url']) && $code['country_flag_url']!=''){ ?> <img src="<?php  echo $code['country_flag_url'] ?>" /><span class="langlabel"> <?php  echo $code['native_name'] ?></span> <?php  }else{?> <?php  echo $code['native_name'] ?> <?php  }?> </div> </div> </a> </div> <?php  }?> </div> <div class="ircpclear"></div><hr class="irchrs" /> <?php  foreach($this->wplanguages as $lang => $code){ if(isset($irc_views['items']) && sizeof($irc_views['items'])){ foreach($irc_views['items'] as $ircv){ if($ircv['seourl_prefix']==$code['language_code'])$this->ircview = $ircv['view_id']; } } $wp_categories = apirc_categories(array('type' => $this->ws_setting['irc_sincro'],'lang' => $code['language_code'])); $irc_categories = ws_request("/models/vclass/visibleRecords",$this->ws_setting,array("view_id" => $this->ircview)); $wp_models =apirc_models(array('type' => $this->ws_setting['irc_sincro'],'lang' => $code['language_code'])); $irc_models = ws_request("/models/model/visibleRecords",$this->ws_setting,array("view_id" => $this->ircview)); if(sizeof($wp_models->posts)){ $pim = array(); foreach($wp_models->posts as $wp_model){ $model_irc_modelid = get_post_meta($wp_model->ID, 'irc_model_id', true); if(!empty($model_irc_modelid))$pim[] = $wp_model;} $wp_models->posts = $pim; } ?> <div id="ircp_import_categories_<?php  echo $code['code'] ?>" class="ircp_import_categories" <?php  if($code['code']!=$this->wplang){?>style="display: none"<?php  }?>> <div class="irc_plugin_sincronize_table_item_col1"> <div style="padding:5px 0;"> <div class="ircpleft" style="padding-right:5px;"> <strong class="ircph2"> <?php  if(isset($this->irccompany['name'])){?><?php  echo ucfirst(mb_strtolower($this->irccompany['name'])) ?><?php  }else{?><?php  echo _irct("Ibexrentacar") ?><?php  }?> </strong> <div class="ircpclear"></div> <div class="ircpleft"><?php  echo $code['native_name'] ?></div> <div class="ircpclear"></div> </div> <div class="ircpright"> <div align="center"> <div class="ircpnumbox"> <strong><?php  echo sizeof($irc_models['items']) ?></strong> <div style="font-size:12px;line-height: 5px;padding-bottom: 10px;"><?php  echo _irct("Modelos") ?></div> </div> </div> </div> <div class="ircpright" style="margin-right: 10px;"> <div align="center"> <div class="ircpnumbox"> <strong><?php  echo sizeof($irc_categories['items']) ?></strong> <div style="font-size:12px;line-height: 5px;padding-bottom: 10px;"><?php  echo _irct("Clases") ?></div> </div> </div> </div> <div class="ircpclear"></div> <div align="center" style="font-size:12px; padding:0;"> <?php  $irccatnames = array(); $ircmodelnames = array(); if(isset($irc_models['items']))usort($irc_models['items'],function ($a,$b) { return $a["name"]>$b["name"]; }); if(isset($irc_categories['items'])){ usort($irc_categories['items'],function ($a,$b) { return $a["name"]>$b["name"]; });?> <?php  foreach($irc_categories['items'] as $irc_cat){ $irccatnames[$irc_cat['name']] = $irc_cat['name'];?> <div class="ircpleft colsynclist"><strong><?php  echo ucfirst(mb_strtolower($irc_cat['name'])) ?></strong></div><div class="ircpclear"></div> <?php  if(isset($irc_models['items'])){?> <div style="margin:5px 0"> <?php  foreach($irc_models['items'] as $irc_model){ $ircmodelnames[$irc_model['name']] = $irc_model['name'];?> <?php  if($irc_cat['vclass_id']==$irc_model['vclass_id']){?> <div class="ircpleft col50"><div align="left"><?php  echo ucfirst(mb_strtolower($irc_model['name'])) ?> (<?php  echo $irc_model['group'] ?>)</div></div> <?php  }?> <?php  }?> <div class="ircpclear"></div> </div> <?php  }?> <?php  }?> <div class="ircpclear"></div> <?php  }else{?> <div class="ircpnoresults"><?php  echo _irct("No dispone de flota activa en su IRC") ?> <?php  echo $code['native_name'] ?>.</div> <?php  }?> </div> </div> </div> <div class="irc_plugin_sincronize_table_item_sep"><div align="center"><img src="<?php  echo $GLOBALS['lsPluginPath'].'/img/arrowsep.png' ?>" width="15" /></div></div> <div class="irc_plugin_sincronize_table_item_col2"> <?php  $wpcatnum = 0; if(sizeof($wp_categories)){ foreach($wp_categories as $wp_cat){ $wp_cat_irc_vclass_id = get_term_meta($wp_cat->cat_ID,'irc_vclass_id',true); if($wp_cat_irc_vclass_id)$wpcatnum++; } } ?> <div style="padding:5px 0;"> <div class="ircpleft" style="padding-right:5px;"> <strong class="ircph2"><?php  echo _irct("Wordpress") ?></strong> <div class="ircpclear"></div> <div class="ircpleft"><?php  echo $code['native_name'] ?></div> <div class="ircpclear"></div> </div> <?php  if($wpcatnum){?> <div class="ircpright"> <div align="center"> <div class="ircpnumbox"><strong><?php  echo sizeof($wp_models->posts) ?></strong> <div style="font-size:12px;line-height: 5px;padding-bottom: 10px;"><?php  echo _irct("Modelos") ?></div> </div> </div> </div> <div class="ircpright" style="margin-right: 10px;"> <div align="center"> <div class="ircpnumbox"> <a href="/wp-admin/edit-tags.php?taxonomy=category" style="text-decoration: none; color:#444" target="_blank"> <strong><?php  echo $wpcatnum ?></strong><div style="font-size:12px;line-height: 5px;padding-bottom: 10px;"><?php  echo _irct("Clases") ?></div> </a> </div> </div> </div> <?php  }else{?> <div class="ircpright"> <div align="center"><img src="<?php  echo $GLOBALS['lsPluginPath'].'/img/noresult.png' ?>" width="50" style="margin-bottom:5px;" /></div> </div> <?php  }?> <div class="ircpclear"></div> <div align="center" style="font-size:12px; padding:0;"> <?php  if($wpcatnum){ ?> <?php  foreach($wp_categories as $wp_cat){ $wp_catvcID = get_term_meta($wp_cat->cat_ID,'irc_vclass_id',true); if($wp_catvcID && $wp_catvcID!=''){?> <div class="ircpleft colsynclist"> <a href="<?php  echo get_category_link($wp_cat->term_id) ?>" style="text-decoration:none" target="_blank"><strong><?php  echo ucfirst(mb_strtolower($wp_cat->name)) ?></strong></a> </div> <div class="ircpclear"></div> <?php  if(sizeof($wp_models->posts)){?> <div style="margin:5px 0"> <?php  foreach($wp_models->posts as $wp_model){ $model_irc_group = get_post_meta($wp_model->ID, 'irc_model_group', true); $model_irc_id = get_post_meta($wp_model->ID, 'irc_model_id', true); $model_irc_cat= get_post_meta($wp_model->ID, 'irc_model_category', true); $model_categories = wp_get_post_categories($wp_model->ID); $view_model = false; foreach($model_categories as $mCat){ if($mCat==$wp_cat->term_id)$view_model = true;} if($view_model){?> <div class="ircpleft col50"> <div align="left"> <a href="<?php  echo get_permalink($wp_model->ID) ?>" style="text-decoration:none" target="_blank"> <?php  echo ucfirst(strtolower($wp_model->post_title)) ?> <?php  if(!empty($model_irc_group)){?>(<?php  echo $model_irc_group ?>)<?php  }?> </a> </div> </div> <?php  }?> <?php  }?> <div class="ircpclear"></div> </div> <div class="ircpclear"></div> <?php  }?> <?php  }?> <?php  }?> <div class="ircpclear"></div> <?php  }else{?> <br /><div> <?php  echo _irct("No dispone de flota en WP") ?> (<?php  echo $code['native_name'] ?>).<br /> <a href="#" onclick="sincronizafleet()" style="text-decoration: none"><?php  echo _irct("Sincronizar ahora") ?></a> </div> <?php  }?> </div> </div> </div> <div class="ircpclear"></div> <?php  if(sizeof($irc_categories['items'])!=$wpcatnum){ if(sizeof($irc_models['items'])!=sizeof($wp_models->posts)){ $irc_import_alerts[] = (sizeof($irc_categories['items'])-$wpcatnum)." "._irct("clases y")." ".(sizeof($irc_models['items'])-sizeof($wp_models->posts))." "._irct("modelos en")." ".$code['native_name']." "._irct("disponibles para su importación a Wordpress"); }else{ $irc_import_alerts[] = (sizeof($irc_categories['items'])-$wpcatnum)." "._irct("categorías nuevas en")." ".$code['native_name']." "._irct("disponibles para su importación a Wordpress"); } } ?> </div><?php  }?><hr class="irchrs2" /><strong><?php  echo _irct("Opciones de importación") ?>:</strong><br /><br /><div><div class="ircpleftpermt" style="width:8%; max-width: 30px;"><input id="irchk_import_default" type="checkbox" checked="checked" style="margin:2px" autocomplete="off" disabled="disabled" /></div><div class="ircpleftpermt" style="padding-left:10px;width:88%;"><?php  echo _irct("Insertar el contenido por defecto si no esta disponible en el idioma de la importación") ?>.</div><div class="ircpclear"></div><div class="ircpleftpermt" style="width:8%; max-width: 30px;"><input id="irchk_import_widget_vehicle" type="checkbox" style="margin:2px" checked="checked" autocomplete="off" /></div><div class="ircpleftpermt" style="padding-left:10px;width:88%;"><?php  echo _irct("Insertar widget de reserva en la ficha del modelo en Wordpress") ?>.</div><div class="ircpclear"></div><div class="ircpleftpermt" style="width:8%; max-width: 30px;"><input id="irchk_import_model_image" type="checkbox" style="margin:2px" checked="checked" autocomplete="off" /></div><div class="ircpleftpermt" style="padding-left:10px;width:88%;"><?php  echo _irct("Exportar/Actualizar la imagen del modelo") ?>.</div> <div class="ircpclear"></div> <div class="ircpleftpermt" style="width:8%; max-width: 30px;"><input id="irchk_import_delete_inactive" type="checkbox" style="margin:2px" autocomplete="off" /></div> <div class="ircpleftpermt" style="padding-left:10px;width:88%;"><?php  echo _irct("Eliminar de Wordpress las categorías y/o modelos inactivos en IRC") ?>.</div> <div class="ircpclear"></div></div><hr class="irchrs2" /> <div class="ircpleft"> <a href="admin.php?page=ibexrentacar&tab=import" style="text-decoration: none"><input type="button" class="ircpButtonGrey" value="<?php  echo _irct("Actualizar") ?>" /></a> </div> <div class="ircpright"> <div class="ircpButtonGreen" onclick="sincronizafleet()"><?php  echo _irct("Sincronizar") ?></div> </div> <div class="ircpclear"></div><hr class="irchrs2" /> <strong><?php  echo _irct("Opciones avanzadas") ?>:</strong><br /> <a href="#" onclick="ircunsetwpfleet()" style="text-decoration: none"><?php  echo _irct("Eliminar toda la flota en Wordpress") ?></a> </div> <div class="ircpclear"></div> </div></div></form>