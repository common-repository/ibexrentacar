<?php
/*
Plugin Name: Ibexrentacar
Plugin URI: http://www.ibexrentacar.com/
Description: Plugin de WordPress para conectar tu blog con la plataforma de gestión de Ibexrentacar.
Version: 1.7
Author: Ibexestudio
Author URI: http://www.ibexrentacar.com
*/
?>
<?php $type = "search";$result_view = "list";$result_view_vclass = "";$result_fleetprice = 0;$result_fleetcategory = 0;$result_view_category = 0;$result_view_model = "";$result_featured_items = "";$result_featured_price = "";$include_jquery = "";$widget_width = "";$widget_width_box_search	= "";$widget_width_results = "";$include_css = 0;$css_widget = "default.css";$include_css = $this->ircurl.'/layout/widget/css/'.$css_widget;$type_view = array( "search" => _irct("Buscador I"),"home" => _irct("Buscador II"),"searchlarge" => _irct("Buscador III"),"searchsmart" => _irct("Buscador Smart"), "fleet" => _irct("Flota"),"featured" => _irct("Modelos destacados"),"modeldata" => _irct("Modelo"),"account" => _irct("Área cliente"),"contact" => _irct("Contacto"));$vclass_lst = ws_request("/models/vclass/visibleRecords",$this->ws_setting,array("view_id" => $this->ircview));$category_lst = ws_request("/models/category/visibleRecords",$this->ws_setting,array("view_id" => $this->ircview));$all_models_lst = ws_request("/models/model/visibleRecords",$this->ws_setting,array("view_id" => $this->ircview));$view_lst = ws_request("/models/view/visibleRecords",$this->ws_setting,array("view_id" => $this->ircview));$session_check = ws_request("/models/session/check",$this->ws_setting,array("view_id" => $this->ircview));$sessio_module = ws_request("/models/module/records",$this->ws_setting,array("view_id" => $this->ircview, "name" => "widget"));if(isset($sessio_module['items']) && sizeof($sessio_module['items']))$include_css = $this->ircurl.'/layout/widget/css/'.$sessio_module['items'][0]['style'].'.css';if(!isset($all_models_lst['items']) || !sizeof($all_models_lst['items'])){unset($type_view['modeldata']); unset($type_view['featured']);}if(isset($this->ircuser['user_template']) && !apirc_isadmin(mb_strtolower($this->ircuser['user_template']))){ unset($type_view['account']); unset($type_view['contact']); } $ircCSSPath = str_replace("/ibexrentacar/","/ibexrentacar_custom/",IBEXRENTACAR_DIR);$ircCSStyle = str_replace("/ibexrentacar/","/ibexrentacar_custom/",$this->plugin_url_base); $ircCSSFile = "widget.css"; $ircCSSFileZIP = "widget.zip";if(!file_exists($ircCSStyle.$customcssfile)){ if(@mkdir(trim($ircCSSPath), 0755, true)){ if(fopen($ircCSSPath.$ircCSSFile, "w"))if($include_css)copy($include_css, $ircCSSPath.$ircCSSFile);}}$this->ircwcss = $ircCSSPath.$ircCSSFile;$file_custom_css = false; $file_custom_css_download = false;if(file_exists($ircCSStyle.$ircCSSFileZIP))$file_custom_css_download = str_replace("/ibexrentacar/","/ibexrentacar_custom/",$GLOBALS['lsPluginPath']).$ircCSSFileZIP;if(is_writable($this->ircwcss)){ wp_enqueue_code_editor( array( 'type' => 'text/html')); $file_custom_css = file_get_contents($this->ircwcss);}?><div class="metabox-holder"> <div class="postbox-container ircpleft ircpmainShortcode"> <div style="width:100% !important; text-align:left"> <div class="ircpleft col20"><div align="center" style="margin-top: 10px;"><img src="<?php  echo $this->plugin_url.'/img/shortcode.png' ?>" style="width:80px;" /></div></div> <div class="ircpleft col70"> <h2><?php  echo _irct("Shortcodes") ?></h2> <strong><?php  echo _irct("Integración en Wordpress") ?></strong><br /> <?php  echo _irct("El plugin contiene diversos tipos de vistas para enlazar con su motor de reservas Ibexrentacar e incluirlos en su página web de Wordpress"); ?>. <a href="?page=ibexrentacar&tab=irc"><?php  echo _irct("Más información") ?></a><br /> </div> <div class="ircpclear"></div><br /> <form id="frm_widget_generate" method="post" action="options.php"> <input type="hidden" name="param_url" value="<?php  echo $this->ircurl ?>" /> <input type="hidden" id="wgaction" name="action" value="code" /> <input type="hidden" name="wplang" value="<?php  echo $this->wplang ?>" /> <div class="postbox"> <h2 class='hndle irchndle' style="min-height: 30px;background-color: #f5f6f7;"> <div class="ircpleft"><span style="line-height:30px;"><strong><?php  echo _irct("Generar Shortcode") ?></strong></span></div> <div class="ircpclear"></div> </h2> <div id="ircpShortcodeSettigs" class="inside"> <div class="ircAccountFormGroup" style="margin-top: 20px;"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Apartado inicial"); ?></div> <div class="ircAccountLeft col6"> <select id="type_view" name="type" class="ircAccountSelect" onchange="viewtype(this.value)" style="background-color: #f5f6f7"> <?php  foreach($type_view as $typev => $title){?><option value="<?php  echo $typev ?>" <?php  if($type==$typev)echo('selected="selected"'); ?>><?php  echo $title ?></option><?php  } ?> </select> </div> <div class="ircAccountClear"></div> </div> <div id="div_view_type" class="ircAccountFormGroup" style="display:<?php  if($type=='fleet'){echo('block');}else{echo('none');}?>"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Vista de resultados"); ?></div> <div class="ircAccountLeft col6"> <select name="result_view" class="ircAccountSelect" onchange="PreviewWidget()"> <option value="list" <?php  if($result_view=='list')echo('selected'); ?>><?php  echo _irct("Listado"); ?></option> <option value="grid" <?php  if($result_view=='grid')echo('selected'); ?>><?php  echo _irct("Mosaico"); ?></option> </select> </div> <div class="ircAccountClear"></div> </div> <div id="div_view_fleetcategory" class="ircAccountFormGroup" style="display:<?php  if($type=='fleet'){echo('block');}else{echo('none');}?>"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Filtro de familias"); ?></div> <div class="ircAccountLeft col6"> <select name="result_fleetcategory" class="ircAccountSelect" onchange="PreviewWidget()"> <option value="0" <?php  if(!$result_fleetcategory)echo('selected'); ?>><?php  echo _irct("No"); ?></option> <option value="1" <?php  if($result_fleetcategory)echo('selected'); ?>><?php  echo _irct("Si"); ?></option> </select> </div> <div class="ircAccountClear"></div> </div> <div id="div_view_category" class="ircAccountFormGroup" style="display:<?php  if($type=='fleet'){echo('block');}else{echo('none');}?>"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Familia inicial"); ?></div> <div class="ircAccountLeft col6"> <select name="result_view_category" class="ircAccountSelect" onchange="PreviewWidget()"> <option value="all"><?php  echo _irct("Todos"); ?></option> <?php  foreach($category_lst['items'] as $CT){ ?> <option value="<?php  echo $CT['category_id']?>" <?php  if($result_view_category==$CT['category_id'])echo('selected'); ?>><?php  echo ucfirst(mb_strtolower($CT['name'])) ?></option> <?php  }?> </select> </div> <div class="ircAccountClear"></div> </div> <div id="div_view_vclass_sel" class="ircAccountFormGroup" style="display:<?php  if($type=='fleet'){echo('block');}else{echo('none');}?>"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Clase inicial"); ?></div> <div class="ircAccountLeft col6"> <select name="result_view_vclass" class="ircAccountSelect" onchange="PreviewWidget()"> <option value="all"><?php  echo _irct("Todos"); ?></option> <?php  foreach($vclass_lst['items'] as $CL){ ?> <option value="<?php  echo $CL['vclass_id']?>" <?php  if($result_view_vclass==$CL['vclass_id'])echo('selected'); ?>><?php  echo ucfirst(mb_strtolower($CL['name'])) ?></option> <?php  }?> </select> </div> <div class="ircAccountClear"></div> </div> <div id="div_view_fleetprice" class="ircAccountFormGroup" style="display:<?php  if($type=='fleet'){echo('block');}else{echo('none');}?>"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Mostrar precio dia"); ?></div> <div class="ircAccountLeft col6"> <select name="result_fleetprice" class="ircAccountSelect" onchange="PreviewWidget()"> <option value="0" <?php  if(!$result_fleetprice)echo('selected'); ?>><?php  echo _irct("No"); ?></option> <option value="1" <?php  if($result_fleetprice)echo('selected'); ?>><?php  echo _irct("Si"); ?></option> </select> </div> <div class="ircAccountClear"></div> </div> <div id="div_view_model" class="ircAccountFormGroup" style="display:<?php  if($type=='modeldata'){echo('block');}else{echo('none');}?>"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Modelo"); ?></div> <div class="ircAccountLeft col6"> <select name="result_view_model" class="ircAccountSelect" onchange="PreviewWidget()"> <?php  foreach($all_models_lst['items'] as $MD){ ?> <option value="<?php  echo $MD['model_id']?>" <?php  if($result_view_model==$MD['model_id'])echo('selected'); ?>><?php  echo ucfirst(mb_strtolower($MD['name'])) ?></option> <?php  }?> </select> </div> <div class="ircAccountClear"></div> </div> <div id="div_view_featured_items" class="ircAccountFormGroup" style="display:<?php  if($type=='modeldata'){echo('block');}else{echo('none');}?>"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Número de modelos"); ?></div> <div class="ircAccountLeft col6"> <select name="result_featured_items" class="ircAccountSelect" onchange="PreviewWidget()"> <?php  for($fi=1;$fi<=12;$fi++){ ?><option value="<?php  echo $fi ?>" <?php  if($result_featured_items==$fi)echo('selected'); ?>><?php  echo $fi?></option><?php  }?> </select> </div> <div class="ircAccountClear"></div> </div> <div id="div_view_featured_price" class="ircAccountFormGroup" style="display:<?php  if($type=='featured'){echo('block');}else{echo('none');}?>"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Mostrar precio dia"); ?></div> <div class="ircAccountLeft col6"> <select name="result_featured_price" class="ircAccountSelect" onchange="PreviewWidget()"> <option value="0" <?php  if(!$result_featured_price)echo('selected'); ?>><?php  echo _irct("No"); ?></option> <option value="1" <?php  if($result_featured_price)echo('selected'); ?>><?php  echo _irct("Si"); ?></option> </select> </div> <div class="ircAccountClear"></div> </div> <div id="box-widget-size" class="ircAccountFormGroup" style="display:none"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Tamaño"); ?> (<?php  echo _irct("Ancho"); ?>)</div> <div class="ircAccountLeft col6"> <select name="widget_width" class="ircAccountSelect" onchange="PreviewWidget()"> <option value="100%" <?php  if($widget_width=='100%')echo('selected'); ?>>100% (Responsive)</option> <option value="950px" <?php  if($widget_width=='950px')echo('selected'); ?>>950px</option> <option value="900px" <?php  if($widget_width=='900px')echo('selected'); ?>>900px</option> <option value="850px" <?php  if($widget_width=='850px')echo('selected'); ?>>850px</option> <option value="800px" <?php  if($widget_width=='800px')echo('selected'); ?>>800px</option> <option value="750px" <?php  if($widget_width=='750px')echo('selected'); ?>>750px</option> <option value="700px" <?php  if($widget_width=='700px')echo('selected'); ?>>700px</option> <option value="650px" <?php  if($widget_width=='650px')echo('selected'); ?>>650px</option> <option value="600px" <?php  if($widget_width=='600px')echo('selected'); ?>>600px</option> </select> </div> <div class="ircAccountClear"></div> </div> <div id="box-widget-size-mix" class="ircAccountFormGroup" style="display:<?php  if($type=='featured'){echo('block');}else{echo('none');}?>"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Tamaño buscador"); ?> (<?php  echo _irct("Ancho"); ?>)</div> <div class="ircAccountLeft col6"> <select name="widget_width_box_search" class="ircAccountSelect" onchange="PreviewWidget()"> <option value="100%" <?php  if($widget_width_box_search=='100%')echo('selected'); ?>>100% (Responsive)</option> <option value="950px" <?php  if($widget_width_box_search=='950px')echo('selected'); ?>>950px</option> <option value="900px" <?php  if($widget_width_box_search=='900px')echo('selected'); ?>>900px</option> <option value="850px" <?php  if($widget_width_box_search=='850px')echo('selected'); ?>>850px</option> <option value="800px" <?php  if($widget_width_box_search=='800px')echo('selected'); ?>>800px</option> <option value="750px" <?php  if($widget_width_box_search=='750px')echo('selected'); ?>>750px</option> <option value="700px" <?php  if($widget_width_box_search=='700px')echo('selected'); ?>>700px</option> <option value="650px" <?php  if($widget_width_box_search=='650px')echo('selected'); ?>>650px</option> <option value="600px" <?php  if($widget_width_box_search=='600px')echo('selected'); ?>>600px</option> <option value="550px" <?php  if($widget_width_box_search=='550px')echo('selected'); ?>>550px</option> <option value="500px" <?php  if($widget_width_box_search=='500px')echo('selected'); ?>>500px</option> <option value="450px" <?php  if($widget_width_box_search=='450px')echo('selected'); ?>>450px</option> <option value="400px" <?php  if($widget_width_box_search=='400px')echo('selected'); ?>>400px</option> </select> </div> <div class="ircAccountClear" style="height:10px"></div> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Tamaño resultados"); ?> (<?php  echo _irct("Ancho"); ?>)</div> <div class="ircAccountLeft col6"> <select name="widget_width_results" class="ircAccountSelect" onchange="PreviewWidget()"> <option value="100%" <?php  if($widget_width_results=='100%')echo('selected'); ?>>100% (Responsive)</option> <option value="950px" <?php  if($widget_width_results=='950px')echo('selected'); ?>>950px</option> <option value="900px" <?php  if($widget_width_results=='900px')echo('selected'); ?>>900px</option> <option value="850px" <?php  if($widget_width_results=='850px')echo('selected'); ?>>850px</option> <option value="800px" <?php  if($widget_width_results=='800px')echo('selected'); ?>>800px</option> <option value="750px" <?php  if($widget_width_results=='750px')echo('selected'); ?>>750px</option> <option value="700px" <?php  if($widget_width_results=='700px')echo('selected'); ?>>700px</option> <option value="650px" <?php  if($widget_width_results=='650px')echo('selected'); ?>>650px</option> <option value="600px" <?php  if($widget_width_results=='600px')echo('selected'); ?>>600px</option> </select> </div> <div class="ircAccountClear"></div> </div> <div class="ircAccountFormGroup"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Idioma"); ?></div> <div class="ircAccountLeft col6"> <select name="view_id_selected" class="ircAccountSelect" onchange="PreviewWidget()"> <?php  foreach($view_lst['items'] as $v){?><?php  if($v['view_id']){?><option value="<?php  echo $v['view_id'] ?>" <?php  if($this->ircview==$v['view_id'])echo('selected'); ?>><?php  echo $v['name'] ?></option><?php  }?><?php  }?> </select> </div> <div class="ircAccountClear"></div> </div> <div class="ircAccountFormGroup"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Incluir Jquery"); ?></div> <div class="ircAccountLeft col6"> <select name="include_jquery" class="ircAccountSelect" onchange="PreviewWidget()"> <option value="0" <?php  if(!$include_jquery)echo('selected'); ?>><?php  echo _irct("No"); ?></option> <option value="1" <?php  if($include_jquery)echo('selected'); ?>><?php  echo _irct("Si"); ?></option> </select> </div> <div class="ircAccountClear"></div> </div> <?php  if($this->is_ws_logged && sizeof($this->ircuser)){ $ukey = $this->ircuser["user_id"]."-".md5($this->ircuser["username"]);?> <div class="ircAccountFormGroup"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Usuario"); ?></div> <div class="ircAccountLeft col6" style="margin-top: 6px;"> <select id="key" name="key" class="ircAccountSelect" onchange="PreviewWidget()"> <option value="<?php  echo $ukey ?>"><?php  echo ucfirst(mb_strtolower($this->ircuser['name'])) ?></option> </select> </div> <div class="ircAccountClear"></div> </div> <?php  }?> <div class="ircAccountFormGroup"> <div class="ircAccountLeft col4 ircAccountInputLabel"><?php  echo _irct("Hoja de estilo"); ?></div> <div class="ircAccountLeft col6" style="margin-top:5px;"> <input type="text" name="include_css" value="<?php  if($include_css){?><?php  echo $include_css ?><?php  }else{?>https://<?php  }?>" class="ircAccountInput" onchange="PreviewWidget()" autocomplete="off" /> </div> <div class="ircAccountClear" style="height:10px;"></div> <div class="ircAccountLeft col4 ircAccountInputLabel"> <?php  echo _irct("Utilizar CSS personalizado"); ?> <span style="font-size: 11px">(<?php  echo _irct("Opcional"); ?>)</span> <div class="ircApssSupTxt"><?php  echo _irct("Añada su propia Hoja de estilos para personalizar su apariencia"); ?>.</div> </div> <div class="ircAccountLeft col6" style="margin-top:8px;"> <input type="checkbox" name="use_customcss" onchange="PreviewWidget()" autocomplete="off" <?php  if(!$file_custom_css){?>disabled="disabled"<?php  }?> /> <a href="javascript:IRCCodeMirror()" style="font-size:14px"><?php  echo _irct("Editar") ?></a><br /> </div> <div class="ircAccountClear"></div> <div id="IRCCodeMirror" class="ircpdn"> <div class="ircpleft"><img class="irctopNavLogo" src="<?php  echo $this->plugin_url.'/img/irctoplogodeveloper.png' ?>" /></div> <div class="ircpleft"><div class="title"><?php  echo _irct("Hoja de estilo") ?></div><div class="subtitle">widget.css</div></div> <div class="ircpright"> <div class="ircpright"><a href="javascript:IRCCodeMirrorClose()"><div class="ircpButtonGrey" style="width:60px; text-align:center"><?php  echo _irct("Cerrar") ?></div></a></div> <?php  if($file_custom_css){?> <div class="ircpright" style="margin-right: 10px"> <a href="javascript:IRCSaveCustomStyle()"><div class="ircpButtonGreen" style="width:60px; text-align:center"><?php  echo _irct("Guardar") ?></div></a> </div> <?php  if($file_custom_css_download){?> <div class="ircpright" style="margin-right: 30px"> <a href="<?php  echo $file_custom_css_download ?>"> <div class="ircpButtonOrange" style="width:22px; text-align:center"><img src="<?php  echo $this->plugin_url.'/img/ircdownload.png' ?>" style="width:25px;padding-top: 6px;" /></div> </a> </div> <?php  }?> <?php  }?> <div class="ircpclear"></div> </div> <div class="ircpclear"></div><hr /> <?php  if($file_custom_css){?> <div id="IRCCodeMirrorLoad" style="display: none"> <div align="center"><br /><img src="<?php  echo $GLOBALS['lsPluginPath'].'/img/ajax-loader.gif' ?>" width="250" /><br /><br /><?php  echo _irct("Espere por favor").'...'; ?><br /><br /></div> </div> <div id="IRCCodeMirrorResult"><div align="center"><?php  echo _irct("Hoja de estilo actualizada!") ?></div></div> <textarea id="IRCCodeMirrorEditor" rows="5" class="widefat textarea"><?php  echo wp_unslash($file_custom_css); ?></textarea> <?php  }else{?> <div align="center"> <img src="<?php  echo $this->plugin_url.'/img/errorauth.png' ?>" width="60" /><br /><?php  echo _irct("Para guardar los cambios, es necesario que el archivo tenga permisos de escritura") ?>. </div> <div align="center"><?php  echo $this->ircwcss ?></div> <?php  } ?> </div> </div> <script type="text/javascript"> jQuery(document).ready(function($){ viewtype(jQuery('#type_view').val());PreviewWidget();});</script> </div> </div> </form> <div class="postbox"> <h2 class='hndle irchndle' style="min-height: 30px;background-color: #f5f6f7;"> <div class="ircpleft"><span style="line-height:30px;"><strong><?php  echo _irct("Previsualización") ?></strong></span></div> <div class="ircpclear"></div> </h2> <div class="inside"> <div id="box-preview-live-widget-loading"><div align="center"><img src="<?php  echo $this->plugin_url.'/img/pircloading.gif' ?>" width="120" /><br /><br /><?php  echo _irct("Espere por favor"); ?>...</div></div> <div id="box-preview-live-widget" style="overflow: hidden;"></div> </div> </div> </div> </div> <div class="postbox-container ircpleft ircpsidebarShortcode"> <div class="postbox"> <h2 class='hndle irchndle' style="min-height: 30px;background-color: #f5f6f7;"> <div class="ircpleft"><span style="line-height:30px;"><strong><?php  echo _irct("Código de integración") ?></strong></span></div><div class="ircpclear"></div> </h2> <div class="inside"> <div id="box-preview-widget-loading"><div align="center"><img src="<?php  echo $this->plugin_url.'/img/pircloading.gif' ?>" width="120" /><br /><br /><?php  echo _irct("Espere por favor"); ?>...</div></div> <div id="box-preview-widget"></div> </div> </div> <div class="postbox" id="irc_shortcode_ircEvent" style="display: none"> <h2 class='hndle irchndle' style="min-height: 30px"> <div class="ircpleft"><span style="line-height:30px;"><strong><?php  echo _irct("Integración personalizada"); ?> (<?php  echo _irct("Opcional"); ?>)</strong></span></div> <div class="ircpclear"></div> </h2> <div class="inside"> <?php  echo _irct("Para poder interactuar con los widgets se ha preparado la función ircEvent, que es ejecutada al realizar la comunicación entre widgets"); ?>. <?php  echo _irct("La variable params contiene la información del mensaje enviado y el parámetro widget indica el elemento en el que se realiza la acción"); ?>.<br /><br /> <strong><?php  echo _irct("Ejemplo"); ?></strong><br /> <?php  echo _irct("Este ejemplo ocultará el div llamado irc_search al cargar los resultados en irc_result, después de una búsqueda desde el módulo search"); ?>. <div class="ircApssCode"> &lt;script type="text/javascript"&gt;<br />ircEvent = function(params) { if (params.widget == 'irc_result' && params.action=='ready') { $('#irc_search').hide();}}<br />&lt;/script&gt; </div> </div> </div> </div> <div class="ircpclear"></div></div><script type="text/javascript"> var irc_plugins_url = "<?php  echo $this->plugin_url ?>";</script>