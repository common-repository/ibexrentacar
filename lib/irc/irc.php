<?php
/*
Plugin Name: Ibexrentacar
Plugin URI: http://www.ibexrentacar.com/
Description: Plugin de WordPress para conectar tu blog con la plataforma de gestión de Ibexrentacar.
Version: 1.7
Author: Ibexestudio
Author URI: http://www.ibexrentacar.com
*/
?>
<?php function ws_request($uri, $wsprams, $params = null) { $token_cache = $wsprams['ibexrentacar_token']; if (file_exists($token_cache)) $params["token"] = file_get_contents($token_cache); else $params["token"] = auth_request($wsprams); if($token_cache)file_put_contents($token_cache, $params["token"]); $response = http_request($uri, $params,$wsprams); if (empty($response["error"])) return $response; elseif ($response["error"]["error_id"] == 1001) { $params["token"] = auth_request($wsprams); file_put_contents($token_cache, $params["token"]); return http_request($uri, $params,$wsprams); }else{}}function auth_request($wsprams) { $ws_username = $wsprams['irc_username'];$ws_password = $wsprams['irc_password']; $response = http_request("/models/session/auth", array("username" => $ws_username, "password" => $ws_password),$wsprams); if (empty($response["error"])) return $response["token"]; elseif ($response["error"]["error_id"] == 1002) return $response["error"]; }function http_request($uri, $params, $wsprams) { global $debug; if(empty($wsprams['irc_url']))return false; $ws_url = $wsprams['irc_url']; if(ini_get('allow_url_fopen')){ $result = file_get_contents($ws_url.$uri, false, stream_context_create(array('http' => array('method' => 'POST','header' => 'Content-type: application/json','content' => json_encode($params))))); }else{ if (function_exists('curl_init') && function_exists('curl_exec')){ $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $ws_url.$uri); curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST"); curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($params)); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_HTTPHEADER, array( 'Content-Type: application/json', 'Content-Length: ' . strlen(json_encode($params))) ); $result = curl_exec($ch); curl_close($ch); } } return json_decode($result,1);}function _irct($text,$lang=false){ global $language_json; $language = "es"; if(defined('IRC_LANGUAGE_CODE'))$language = IRC_LANGUAGE_CODE; if(defined('ICL_LANGUAGE_CODE'))$language = ICL_LANGUAGE_CODE; if($lang)$language = $lang; $translates_json = json_decode($language_json, true); $translation = $text; $trim_text = str_replace(" ","_",trim($text)); if(isset($translates_json[$trim_text][$language])){$translation = $translates_json[$trim_text][$language]; $translation = str_replace("\'","'",$translation);} return $translation; }function apidecStr(){ return "&gDJV#YTb7*\S";}function api_getPost($taxonomy,$post_type,$lang){ global $sitepress; if(defined('ICL_LANGUAGE_CODE'))$sitepress->switch_lang($lang); $categories = get_categories(array('type'=> 'post','child_of'=> 0,'parent'=>'','orderby'=> 'name','order'=> 'ASC','hide_empty'=> 0,'hierarchical'=> 1,'exclude'=> '','post_type'=> $post_type,'include'=> '','number'=> '','taxonomy'=> $taxonomy,'posts_per_page'=> 100,'pad_counts'=> false)); return $categories;}function api_getPostsModels($lang){ global $product, $sitepress; if(defined('ICL_LANGUAGE_CODE'))$sitepress->switch_lang($lang); $products = new WP_Query(array('post_type' => 'post','orderby' => 'name','posts_per_page' => 100,'order' => 'ASC')); wp_reset_query(); return $products;}function api_getLanguages(){ $wpml_langs = icl_get_languages(); $wpml_langs_active = array(); foreach($wpml_langs as $lang => $code){ $is_wpml_hidden = in_array($code['language_code'], apply_filters('wpml_setting', array(),'hidden_languages')); if(!$is_wpml_hidden)$wpml_langs_active[$lang] = $code;} return $wpml_langs_active;}function api_getDefaultLanguages($purl){ $wplanguages = array('es' => array("code" => "es","language_code" => "es", "native_name" => "Español", "country_flag_url" => $purl.'/img/language/es.png'), 'en' => array("code" => "en","language_code" => "en", "native_name" => "English", "country_flag_url" => $purl.'/img/language/en.png'), 'ca' => array("code" => "ca","language_code" => "ca", "native_name" => "Català", "country_flag_url" => $purl.'/img/language/ca.png')); return $wplanguages;}function apidecExp(){ return str_replace('/','-',str_replace('|','','/i|p|a/'));}function apirc_categories($args){ $wp_categories = api_getPost('category','post',$args['lang']);return $wp_categories;}function apirc_models($args){ $wp_models = api_getPostsModels($args['lang']); return $wp_models;}function apirc_currency($prc){ global $irc_currency; $_cur = apirc_getcurrency($irc_currency); return number_format($prc,2).' '.$_cur['symbol'];}function apidec($enc){ if(empty($enc))return false; if(function_exists('openssl_encrypt') && function_exists('openssl_decrypt')){ $iv = substr($enc, 0, 16); $string = substr($enc, 16); $ircstr	= apidecStrWp()."-"; $ircstr .= apidecStr(); $output = openssl_decrypt(base64_decode($string), "AES-256-CBC", hash('sha256', $ircstr), 0, $iv); return explode(apidecExp(),$output); }else{ return false;}}function apirc_legal(){ return "<p> "._irct("Más información").": <a href='http://www.ibexrentacar.com' target='_blank'>www.ibexrentacar.com</a><br /> "._irct("Soporte").": <a href='mailto:info@ibexrentacar.com'>info@ibexrentacar.com</a><br /> Ibexrentacar plugin by <a href='http://www.ibexestudio.com' target='_blank'>Ibexestudio</a><br /> Ibexrentacar.com ©".date('Y')."<br /> </p>";}function apirc_isadmin($utID){ if(md5($utID)=="91f5167c34c400758115c2a6826ec2e3")return true; if(md5($utID)=="f8032d5cae3de20fcec887f395ec9a6a")return true; return false;}function apirc_getcurrency($currency){ $iso4217 = array('ALL' =>array('symbol' => 'Lek', 'code' => 'ALL', 'name' => 'Albania Lek',),'AFN' =>array('symbol' => 'Af', 'code' => 'AFN', 'name' => 'Afghanistan Afghani',),'ARS' =>array('symbol' => '$', 'code' => 'ARS', 'name' => 'Argentina Peso',),'AWG' =>array('symbol' => 'ƒ', 'code' => 'AWG', 'name' => 'Aruba Guilder',),'AUD' =>array('symbol' => '$', 'code' => 'AUD', 'name' => 'Australia Dollar',),'AZN' =>array('symbol' => 'ман', 'code' => 'AZN', 'name' => 'Azerbaijan New Manat',),'BSD' =>array('symbol' => '$', 'code' => 'BSD', 'name' => 'Bahamas Dollar',),'BBD' =>array('symbol' => '$', 'code' => 'BBD', 'name' => 'Barbados Dollar',),'BDT' =>array('symbol' => '৳', 'code' => 'BDT', 'name' => 'Bangladeshi taka',),'BYR' =>array('symbol' => 'p.', 'code' => 'BYR', 'name' => 'Belarus Ruble',),'BZD' =>array('symbol' => 'BZ$', 'code' => 'BZD', 'name' => 'Belize Dollar',),'BMD' =>array('symbol' => '$', 'code' => 'BMD', 'name' => 'Bermuda Dollar',),'BOB' =>array('symbol' => '$b', 'code' => 'BOB', 'name' => 'Bolivia Boliviano',),'BAM' =>array('symbol' => 'KM', 'code' => 'BAM', 'name' => 'Bosnia and Herzegovina Convertible Marka',),'BWP' =>array('symbol' => 'P', 'code' => 'BWP', 'name' => 'Botswana Pula',),'BGN' =>array('symbol' => 'лв', 'code' => 'BGN', 'name' => 'Bulgaria Lev',),'BRL' =>array('symbol' => 'R$', 'code' => 'BRL', 'name' => 'Brazil Real',),'BND' =>array('symbol' => '$', 'code' => 'BND', 'name' => 'Brunei Darussalam Dollar',),'KHR' =>array('symbol' => '៛', 'code' => 'KHR', 'name' => 'Cambodia Riel',),'CAD' =>array('symbol' => '$', 'code' => 'CAD', 'name' => 'Canada Dollar',),'KYD' =>array('symbol' => '$', 'code' => 'KYD', 'name' => 'Cayman Islands Dollar',),'CLP' =>array('symbol' => '$', 'code' => 'CLP', 'name' => 'Chile Peso',),'CNY' =>array('symbol' => '¥', 'code' => 'CNY', 'name' => 'China Yuan Renminbi',),'COP' =>array('symbol' => '$', 'code' => 'COP', 'name' => 'Colombia Peso',),'CRC' =>array('symbol' => '₡', 'code' => 'CRC', 'name' => 'Costa Rica Colon',),'HRK' =>array('symbol' => 'kn', 'code' => 'HRK', 'name' => 'Croatia Kuna',),'CUP' =>array('symbol' => '⃌', 'code' => 'CUP', 'name' => 'Cuba Peso',),'CZK' =>array('symbol' => 'Kč', 'code' => 'CZK', 'name' => 'Czech Republic Koruna',),'DKK' =>array('symbol' => 'kr', 'code' => 'DKK', 'name' => 'Denmark Krone',),'DOP' =>array('symbol' => 'RD$', 'code' => 'DOP', 'name' => 'Dominican Republic Peso',),'XCD' =>array('symbol' => '$', 'code' => 'XCD', 'name' => 'East Caribbean Dollar',),'EGP' =>array('symbol' => '£', 'code' => 'EGP', 'name' => 'Egypt Pound',),'SVC' =>array('symbol' => '$', 'code' => 'SVC', 'name' => 'El Salvador Colon',),'EEK' =>array('symbol' => '', 'code' => 'EEK', 'name' => 'Estonia Kroon',),'EUR' =>array('symbol' => '€', 'code' => 'EUR', 'name' => 'Euro Member Countries',),'FKP' =>array('symbol' => '£', 'code' => 'FKP', 'name' => 'Falkland Islands (Malvinas) Pound',),'FJD' =>array('symbol' => '$', 'code' => 'FJD', 'name' => 'Fiji Dollar',),'GHC' =>array('symbol' => '', 'code' => 'GHC', 'name' => 'Ghana Cedis',),'GIP' =>array('symbol' => '£', 'code' => 'GIP', 'name' => 'Gibraltar Pound',),'GTQ' =>array('symbol' => 'Q', 'code' => 'GTQ', 'name' => 'Guatemala Quetzal',),'GGP' =>array('symbol' => '', 'code' => 'GGP', 'name' => 'Guernsey Pound',),'GYD' =>array('symbol' => '$', 'code' => 'GYD', 'name' => 'Guyana Dollar',),'HNL' =>array('symbol' => 'L', 'code' => 'HNL', 'name' => 'Honduras Lempira',),'HKD' =>array('symbol' => '$', 'code' => 'HKD', 'name' => 'Hong Kong Dollar',),'HUF' =>array('symbol' => 'Ft', 'code' => 'HUF', 'name' => 'Hungary Forint',),'ISK' =>array('symbol' => 'kr', 'code' => 'ISK', 'name' => 'Iceland Krona',),'INR' =>array('symbol' => '₹', 'code' => 'INR', 'name' => 'India Rupee',),'IDR' =>array('symbol' => 'Rp', 'code' => 'IDR', 'name' => 'Indonesia Rupiah',),'IRR' =>array('symbol' => '﷼', 'code' => 'IRR', 'name' => 'Iran Rial',),'IMP' =>array('symbol' => '', 'code' => 'IMP', 'name' => 'Isle of Man Pound',),'ILS' =>array('symbol' => '₪', 'code' => 'ILS', 'name' => 'Israel Shekel',),'JMD' =>array('symbol' => 'J$', 'code' => 'JMD', 'name' => 'Jamaica Dollar',),'JPY' =>array('symbol' => '¥', 'code' => 'JPY', 'name' => 'Japan Yen',),'JEP' =>array('symbol' => '£', 'code' => 'JEP', 'name' => 'Jersey Pound',),'KZT' =>array('symbol' => 'лв', 'code' => 'KZT', 'name' => 'Kazakhstan Tenge',),'KPW' =>array('symbol' => '₩', 'code' => 'KPW', 'name' => 'Korea (North) Won',),'KRW' =>array('symbol' => '₩', 'code' => 'KRW', 'name' => 'Korea (South) Won',),'KGS' =>array('symbol' => 'лв', 'code' => 'KGS', 'name' => 'Kyrgyzstan Som',),'LAK' =>array('symbol' => '₭', 'code' => 'LAK', 'name' => 'Laos Kip',),'LVL' =>array('symbol' => 'Ls', 'code' => 'LVL', 'name' => 'Latvia Lat',),'LBP' =>array('symbol' => '£', 'code' => 'LBP', 'name' => 'Lebanon Pound',),'LRD' =>array('symbol' => '$', 'code' => 'LRD', 'name' => 'Liberia Dollar',),'LTL' =>array('symbol' => 'Lt', 'code' => 'LTL', 'name' => 'Lithuania Litas',),'MKD' =>array('symbol' => 'ден', 'code' => 'MKD', 'name' => 'Macedonia Denar',),'MYR' =>array('symbol' => 'RM', 'code' => 'MYR', 'name' => 'Malaysia Ringgit',),'MUR' =>array('symbol' => '₨', 'code' => 'MUR', 'name' => 'Mauritius Rupee',),'MXN' =>array('symbol' => '$', 'code' => 'MXN', 'name' => 'Mexico Peso',),'MNT' =>array('symbol' => '₮', 'code' => 'MNT', 'name' => 'Mongolia Tughrik',),'MZN' =>array('symbol' => 'MT', 'code' => 'MZN', 'name' => 'Mozambique Metical',),'NAD' =>array('symbol' => '$', 'code' => 'NAD', 'name' => 'Namibia Dollar',),'NPR' =>array('symbol' => '₨', 'code' => 'NPR', 'name' => 'Nepal Rupee',),'ANG' =>array('symbol' => 'ƒ', 'code' => 'ANG', 'name' => 'Netherlands Antilles Guilder',),'NZD' =>array('symbol' => '$', 'code' => 'NZD', 'name' => 'New Zealand Dollar',),'NIO' =>array('symbol' => 'C$', 'code' => 'NIO', 'name' => 'Nicaragua Cordoba',),'NGN' =>array('symbol' => '₦', 'code' => 'NGN', 'name' => 'Nigeria Naira',),'NOK' =>array('symbol' => 'kr', 'code' => 'NOK', 'name' => 'Norway Krone',),'OMR' =>array('symbol' => '﷼', 'code' => 'OMR', 'name' => 'Oman Rial',),'PKR' =>array('symbol' => '₨', 'code' => 'PKR', 'name' => 'Pakistan Rupee',),'PAB' =>array('symbol' => 'B/.', 'code' => 'PAB', 'name' => 'Panama Balboa',),'PYG' =>array('symbol' => 'Gs', 'code' => 'PYG', 'name' => 'Paraguay Guarani',),'PEN' =>array('symbol' => 'S/.', 'code' => 'PEN', 'name' => 'Peru Nuevo Sol',),'PHP' =>array('symbol' => '₱', 'code' => 'PHP', 'name' => 'Philippines Peso',),'PLN' =>array('symbol' => 'zł', 'code' => 'PLN', 'name' => 'Poland Zloty',),'QAR' =>array('symbol' => '﷼', 'code' => 'QAR', 'name' => 'Qatar Riyal',),'RON' =>array('symbol' => 'lei', 'code' => 'RON', 'name' => 'Romania New Leu',),'RUB' =>array('symbol' => 'руб', 'code' => 'RUB', 'name' => 'Russia Ruble',),'SHP' =>array('symbol' => '£', 'code' => 'SHP', 'name' => 'Saint Helena Pound',),'SAR' =>array('symbol' => '﷼', 'code' => 'SAR', 'name' => 'Saudi Arabia Riyal',),'RSD' =>array('symbol' => 'Дин.', 'code' => 'RSD', 'name' => 'Serbia Dinar',),'SCR' =>array('symbol' => '₨', 'code' => 'SCR', 'name' => 'Seychelles Rupee',),'SGD' =>array('symbol' => '$', 'code' => 'SGD', 'name' => 'Singapore Dollar',),'SBD' =>array('symbol' => '$', 'code' => 'SBD', 'name' => 'Solomon Islands Dollar',),'SOS' =>array('symbol' => 'S', 'code' => 'SOS', 'name' => 'Somalia Shilling',),'ZAR' =>array('symbol' => 'R', 'code' => 'ZAR', 'name' => 'South Africa Rand',),'LKR' =>array('symbol' => '₨', 'code' => 'LKR', 'name' => 'Sri Lanka Rupee',),'SEK' =>array('symbol' => 'kr', 'code' => 'SEK', 'name' => 'Sweden Krona',),'CHF' =>array('symbol' => 'CHF', 'code' => 'CHF', 'name' => 'Switzerland Franc',),'SRD' =>array('symbol' => '$', 'code' => 'SRD', 'name' => 'Suriname Dollar',),'SYP' =>array('symbol' => '£', 'code' => 'SYP', 'name' => 'Syria Pound',),'TWD' =>array('symbol' => 'NT$', 'code' => 'TWD', 'name' => 'Taiwan New Dollar',),'THB' =>array('symbol' => '฿', 'code' => 'THB', 'name' => 'Thailand Baht',),'TTD' =>array('symbol' => '$', 'code' => 'TTD', 'name' => 'Trinidad and Tobago Dollar',),'TRY' =>array('symbol' => '₤', 'code' => 'TRY', 'name' => 'Turkey Lira',),'TRL' =>array('symbol' => '', 'code' => 'TRL', 'name' => 'Turkey Lira',),'TVD' =>array('symbol' => '', 'code' => 'TVD', 'name' => 'Tuvalu Dollar',),'UAH' =>array('symbol' => '₴', 'code' => 'UAH', 'name' => 'Ukraine Hryvna',),'GBP' =>array('symbol' => '£', 'code' => 'GBP', 'name' => 'United Kingdom Pound',),'USD' =>array('symbol' => '$', 'code' => 'USD', 'name' => 'United States Dollar',),'UYU' =>array('symbol' => '$U', 'code' => 'UYU', 'name' => 'Uruguay Peso',),'UZS' =>array('symbol' => 'лв', 'code' => 'UZS', 'name' => 'Uzbekistan Som',),'VEF' =>array('symbol' => 'Bs', 'code' => 'VEF', 'name' => 'Venezuela Bolivar',),'VND' =>array('symbol' => '₫', 'code' => 'VND', 'name' => 'Viet Nam Dong',),'YER' =>array('symbol' => '﷼', 'code' => 'YER', 'name' => 'Yemen Rial',),'ZWD' =>array('symbol' => '', 'code' => 'ZWD', 'name' => 'Zimbabwe Dollar',),);return $iso4217[$currency];}function apidecStrWp(){return "5Z";} 