<?php if (!function_exists('is_admin')) { header('Status: 403 Forbidden'); header('HTTP/1.1 403 Forbidden'); exit();} include(trailingslashit(plugin_dir_path( __FILE__ )).'lib/irc/wp.php');include(trailingslashit(plugin_dir_path( __FILE__ )).'lib/irc/irc.php'); if (!class_exists("Ibexrentacar_Settings")) : class Ibexrentacar_Settings { var $pagehook, $page_id, $settings_field, $options; public static $default_settings = array('irc_apikey'=>'','irc_url'=>'','irc_wpml'=>'','irc_username'=>'','irc_password'=>'','ibexrentacar_token'=>'','irc_gmaps_key'=>''); var $ircview, $wplang, $wplanguages, $ircuser, $irccompany, $ircurl, $plugin_url_base, $plugin_url, $pluginfiles, $ws_setting, $is_ws_logged, $ircwcss; function __construct(){ $this->page_id = 'ibexrentacar'; $this->settings_field = 'ibexrentacar_options'; $this->options = get_option($this->settings_field); add_action('admin_init', array($this,'admin_init'), 20); add_action('admin_menu', array($this, 'admin_menu'), 20); } function admin_init(){ if(isset($this->options['irc_apikey']) && $this->options['irc_apikey']!='')$dec = apidec($this->options['irc_apikey']); if(isset($dec[0]) && $dec[0]!='')$this->options['irc_url'] = $dec[0];if(isset($dec[1]) && $dec[1]!=''){ $this->options['irc_username'] = $dec[1];} register_setting($this->settings_field, $this->settings_field,array($this, 'sanitize_theme_options')); add_option($this->settings_field, Ibexrentacar_Settings::$default_settings); } function admin_menu() { $insert_params = false; $param_url = $this->get_field_value('irc_url'); $param_user = $this->get_field_value('irc_username'); $param_pass = $this->get_field_value('irc_password'); if($param_url!='' && $param_user!='' && $param_pass!='')$insert_params = true; if(!current_user_can('update_plugins'))return; $this->pagehook = add_menu_page( __('Ibexrentacar', 'ibexrentacar'), __('Ibexrentacar', 'ibexrentacar'), 'administrator', $this->page_id, array($this,'render'), plugins_url('/', __FILE__).'/img/icon4_16x16.png'); add_action('load-'.$this->pagehook, array( $this, 'metaboxes')); add_action("admin_print_scripts-$page", array($this, 'js_includes')); } protected function get_field_name($name){ return sprintf('%s[%s]', $this->settings_field, $name ); } protected function get_field_id($id){ return sprintf('%s[%s]', $this->settings_field, $id );} protected function get_field_value($key){ return $this->options[$key];} function metaboxes(){} function js_includes(){ wp_enqueue_script('postbox');} function irc_shortcodes(){ include($this->pluginfiles.'shortcode/shortcode.php');}  function irc_support(){ include($this->pluginfiles.'support/support.php');} function irc_docu(){ include($this->pluginfiles.'support/documentation.php');} function irc_company(){ include($this->pluginfiles.'irc/company.php');} function irc_account(){ include($this->pluginfiles.'irc/user.php');} function irc_sidebar(){ include($this->pluginfiles.'support/sidebar.php');} function irc_connection(){ include($this->pluginfiles.'irc/config.php');} function irc_sync(){include($this->pluginfiles.'import/sync.php');} function render() { global $wp_meta_boxes, $language_json, $irc_currency; $messages[1] = __('Ibexrentacar action taken.', 'ibexrentacar'); if(isset($_GET['message']) && (int) $_GET['message']){ $message = $messages[$_GET['message']]; $_SERVER['REQUEST_URI'] = remove_query_arg(array('message'), $_SERVER['REQUEST_URI']);} $title = __('Ibexrentacar', 'ibexrentacar'); $decparams = apidec(esc_attr($this->get_field_value('irc_apikey'))); $pirckey = $this->get_field_value('irc_apikey'); $param_url = $this->get_field_value('irc_url'); $param_user = $this->get_field_value('irc_username'); $param_pass = $this->get_field_value('irc_password'); $param_wpml = $this->get_field_value('irc_wpml'); $param_gMapsKey = $this->get_field_value('irc_gmaps_key'); $this->plugin_url = plugins_url('/', __FILE__); $this->ws_setting = array('irc_apikey'=>$pirckey,'irc_url'=>$param_url,'irc_username'=>$param_user,'irc_password'=>$param_pass,'irc_wpml'=>$param_wpml,'irc_sincro'=>$param_sync, 'irc_gmaps_key'=>$param_gMapsKey); $this->ircview = 1; $irc_currency = "EUR"; $this->plugin_url_base = trailingslashit(plugin_dir_path( __FILE__ )); $this->pluginfiles = trailingslashit(plugin_dir_path( __FILE__ )).'lib/irc/frontend/'; $this->is_ws_logged = false; $this->ircurl = $param_url; $this->wplang = substr(get_locale(),0,2); $this->wplanguages = api_getDefaultLanguages($this->plugin_url); $param_sync = 'post'; $insert_params = false; if($pirckey==""){$param_url="";$param_user="";} if($pirckey!='' && $param_pass!='')$insert_params = true; wp_register_style('ircadminstyle', $this->plugin_url.'/lib/css/ircwp.css'); wp_enqueue_style('ircadminstyle'); /*Language*/ if(defined('ICL_LANGUAGE_CODE'))$param_wpml='yes'; if(!isset($this->wplanguages[$this->wplang]))$this->wplang = "en"; if(isset($param_wpml) && $param_wpml=='yes' && defined('ICL_LANGUAGE_CODE'))$this->wplang = ICL_LANGUAGE_CODE; if(isset($param_wpml) && $param_wpml=='yes' && defined('ICL_LANGUAGE_CODE'))$this->wplanguages = api_getLanguages(); define('IRC_LANGUAGE_CODE',$this->wplang); if(!defined('ICL_LANGUAGE_CODE'))$this->wplanguages = array($this->wplang => $this->wplanguages[$this->wplang]); /*WS API*/ $session_check = ws_request("/models/session/check",$this->ws_setting,array("view_id" => $this->ircview)); $session_user = ws_request("/models/user/visibleRecords",$this->ws_setting,array("view_id" => $this->ircview, "username" => $param_user)); $session_company = ws_request("/models/company/visibleRecords",$this->ws_setting,array("view_id" => $this->ircview)); if(isset($session_check['ok']))$this->is_ws_logged = true; if(isset($session_user['items'][0]))$this->ircuser = $session_user['items'][0]; if(isset($session_company['items'][0]))$this->irccompany = $session_company['items'][0]; if(isset($this->irccompany['currency']) && $this->irccompany['currency']!='')$irc_currency = $this->irccompany['currency']; include(trailingslashit(plugin_dir_path( __FILE__ )).'lib/language/language.php'); include(trailingslashit(plugin_dir_path( __FILE__ )).'lib/irc/js.php'); add_meta_box('ibexrentacar-version',_irct("Opciones generales"), array( $this, 'irc_connection'), $this->pagehook, 'main', 'high'); add_meta_box('ibexrentacar-publi', 'Ibexrentacar.com', array($this, 'irc_sidebar'), $this->pagehook, 'sidebar', 'high'); add_meta_box('ibexrentacar-company', _irct("Datos de empresa"), array($this, 'irc_company'), $this->pagehook, 'company', 'high'); add_meta_box('ibexrentacar-user', _irct("Mi cuenta"), array($this, 'irc_account'), $this->pagehook, 'user', 'high'); add_meta_box('ibexrentacar-irc', _irct("Documentación"), array($this, 'irc_docu'), $this->pagehook, 'irc', 'high'); add_meta_box('ibexrentacar-support', _irct("Atención al cliente"), array($this, 'irc_support'), $this->pagehook, 'support', 'high'); add_meta_box('ibexrentacar-shortcode', _irct("Integración"), array($this, 'irc_shortcodes'), $this->pagehook, 'shortcodes', 'high'); add_meta_box('ibexrentacar-import', _irct("Importar"), array($this, 'irc_sync'), $this->pagehook, 'import', 'high');  include($this->pluginfiles.'irc/layout/head.php'); include($this->pluginfiles.'irc/layout/layout.php'); include($this->pluginfiles.'irc/layout/foot.php'); } } endif;?>