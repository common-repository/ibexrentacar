<?php
/*
Plugin Name: Ibexrentacar
Plugin URI: http://www.ibexrentacar.com/
Description: Plugin de WordPress para conectar tu blog con la plataforma de gestión de Ibexrentacar.
Version: 1.7
Author: Ibexestudio
Author URI: http://www.ibexrentacar.com
*/
?>
<?php if (!function_exists('is_admin')) { header('Status: 403 Forbidden'); header('HTTP/1.1 403 Forbidden'); exit();}error_reporting(0); ini_set('display_errors', 0);if (!defined( 'WP_CONTENT_URL'))define('WP_CONTENT_URL', get_option( 'siteurl' ) . '/wp-content');if (!defined( 'WP_CONTENT_DIR'))define('WP_CONTENT_DIR', ABSPATH . 'wp-content'); define('IBEXRENTACAR_VERSION','1.7');define('IBEXRENTACAR_RELEASE_DATE', date_i18n( 'F j, Y', time()));define('IBEXRENTACAR_DIR', trailingslashit( plugin_dir_path( __FILE__ )));define('IBEXRENTACAR_URL', trailingslashit( plugin_dir_url( __FILE__ )));$GLOBALS['lsPluginPath'] = plugins_url('/', __FILE__); if (!class_exists("Ibexrentacar")) : class Ibexrentacar { var $settings, $options_page; function __construct() { if(is_admin()){if(!class_exists("Ibexrentacar_Settings"))require(IBEXRENTACAR_DIR.'/ibexrentacar-settings.php');$this->settings = new Ibexrentacar_Settings();} add_action('init', array($this,'init')); add_action('admin_init',array($this,'admin_init'));add_action('admin_menu',array($this,'admin_menu')); register_activation_hook( __FILE__, array($this,'activate') ); register_deactivation_hook( __FILE__, array($this,'deactivate') ); } function network_propagate($pfunction, $networkwide) { global $wpdb; if (function_exists('is_multisite') && is_multisite()) { if ($networkwide) { $old_blog = $wpdb->blogid; $blogids = $wpdb->get_col("SELECT blog_id FROM {$wpdb->blogs}"); foreach ($blogids as $blog_id){ switch_to_blog($blog_id); call_user_func($pfunction, $networkwide);} switch_to_blog($old_blog); return; } } call_user_func($pfunction, $networkwide); }  function _activate(){} function _deactivate(){} function admin_init(){} function admin_menu(){} function activate($networkwide){ $this->network_propagate(array($this, '_activate'), $networkwide); } function deactivate($networkwide){ $this->network_propagate(array($this, '_deactivate'), $networkwide);} function init(){ load_plugin_textdomain('ibexrentacar', IBEXRENTACAR_DIR.'/lang',basename(dirname( __FILE__ )).'/lang');} function javascript_redirect($location) { ?> <script type="text/javascript"> window.location= <?php  echo "'" . $location . "'"; ?>; </script> <?php  exit;} } endif; global $ibexrentacar;global $settings_ibex; if (class_exists("Ibexrentacar") && !$ibexrentacar)$ibexrentacar = new Ibexrentacar();if (!class_exists("Ibexrentacar_Settings")){ require(IBEXRENTACAR_DIR.'/ibexrentacar-settings.php'); $settings_ibex = new Ibexrentacar_Settings();} if(!empty($settings_ibex->options['irc_apikey']) && empty($settings_ibex->options['irc_url'])){ $dec = apidec($settings_ibex->options['irc_apikey']); $settings_ibex->options['irc_url'] = $dec[0];} if(!empty($settings_ibex->options['irc_apikey']) && empty($settings_ibex->options['irc_username'])){$dec = apidec($settings_ibex->options['irc_apikey']); $settings_ibex->options['irc_username'] = $dec[1];} function shortcode_ibexrentacar($atts){ global $settings_ibex; $ws_settings = array('irc_url' => $settings_ibex->options['irc_url'],'irc_username' => $settings_ibex->options['irc_username'],'irc_password' => $settings_ibex->options['irc_password']); if(isset($settings_ibex->options['irc_apikey']) && $settings_ibex->options['irc_apikey']!='')$dec = apidec($settings_ibex->options['irc_apikey']); if(isset($dec[0]) && $dec[0]!='')$ws_settings['irc_url'] = $dec[0];if(isset($dec[1]) && $dec[1]!=''){ $ws_settings['irc_username'] = $dec[1];} $session_check = ws_request("/models/session/check",$ws_settings,array("view_id" => 1)); extract(shortcode_atts(array('width'=>'100%','result_width'=>'100%','include_jquery'=> '0','view'=> '1','result_view'=> 'list','vclass'=> '','vprice'=> '0','include_css'=> '','model'=> '', 'featured_items'=> '','type'=> '','autoload'=> '0','layout'=> 'block','key'=> '',), $atts)); if(isset($session_check['ok'])){ if($type=="result"){ return '<div id="irc_result" style="width: '.$result_width.';"></div>'; }else{ $wsrc = $settings_ibex->options['irc_url'].'/widget/?include_jquery='.$include_jquery.'&view_id='.$view.'&result_view='.$result_view; if($include_css!=''){ $wsrc .= '&include_css='.$include_css;}else{$sessio_module = ws_request("/models/module/records",$ws_settings,array("view_id" => 1, "name" => "widget")); if(isset($sessio_module['items']) && sizeof($sessio_module['items'])){$wsrc .= '&include_css='.$settings_ibex->options['irc_url'].'/layout/widget/css/'.$sessio_module['items'][0]['style'].'.css';} } if($key!=''){ $wsrc .= "&key=".$key; }else{ $session_user = ws_request("/models/user/visibleRecords",$ws_settings,array("view_id" => 1, "username" => $settings_ibex->options['irc_username'])); if(isset($session_user['items'][0]))$wsrc .= "&key=".$session_user['items'][0]["user_id"]."-".md5($session_user['items'][0]["username"]);}if($model!='')$wsrc .= '&model='.$model; if($featured_items!=''){$wsrc .= '&featured_items='.$featured_items;}else{ if($type=="featured")$wsrc .= '&featured_items=4';} $result_wiget_content = '<div id="irc_'.$type.'" style="width: '.$width.';"></div>'; if($type=="modeldata")$result_wiget_content = '<div id="irc_vehicle" style="width: '.$width.';"></div>'; if(($type=='search' || $type=='searchsmart' || $type=='searchlarge') && $layout=="block")$result_wiget_content .= '<div id="irc_result" style="width: '.$result_width.';"></div>'; if($autoload)$wsrc .= '&autoload=1'; $wsrc .= '&autoscroll=0'; return '<script async="async" src="'.$wsrc.'"></script>'.$result_wiget_content; } }else{ return "IRC: "._irct("Revise la configuración del plugin"); }} add_shortcode('irc','shortcode_ibexrentacar'); /*DEPRECATED SHORTCODES*/function shortcode_ibexrentacar_fleet($atts){ $atts['type'] = "fleet"; $atts['view'] = 1; if(isset($atts['locale'])){switch($atts['locale']){case 'en_EN': $atts['view'] = 2; break; default: break;}} return shortcode_ibexrentacar($atts);}add_shortcode('ibexrentacar-fleet','shortcode_ibexrentacar_fleet'); function shortcode_ibexrentacar_results($atts){ $atts['type'] = "result";$atts['autoload'] = 1;$atts['view'] = 1; if(isset($atts['locale'])){switch($atts['locale']){case 'en_EN': $atts['view'] = 2; break; default: break;}} return shortcode_ibexrentacar($atts);} add_shortcode('ibexrentacar-results','shortcode_ibexrentacar_results'); function shortcode_ibexrentacar_fleetsale($atts){}add_shortcode('ibexrentacar-fleetsale','shortcode_ibexrentacar_fleetsale'); function shortcode_ibexrentacar_buscador1($atts){ $atts['type'] = "search"; $atts['view'] = 1; if(isset($atts['locale'])){switch($atts['locale']){case 'en_EN': $atts['view'] = 2; break; default: break;}} return shortcode_ibexrentacar($atts);}add_shortcode('ibexrentacar-buscador1','shortcode_ibexrentacar_buscador1');function shortcode_ibexrentacar_buscador2($atts){ $atts['type'] = "home"; $atts['view'] = 1; if(isset($atts['locale'])){switch($atts['locale']){case 'en_EN': $atts['view'] = 2; break; default: break;}}	return shortcode_ibexrentacar($atts);}add_shortcode('ibexrentacar-buscador2','shortcode_ibexrentacar_buscador2'); function shortcode_ibexrentacar_buscador3($atts){ $atts['type'] = "searchlarge"; $atts['view'] = 1; if(isset($atts['locale'])){switch($atts['locale']){case 'en_EN': $atts['view'] = 2; break; default: break;}} return shortcode_ibexrentacar($atts);} add_shortcode('ibexrentacar-buscador3','shortcode_ibexrentacar_buscador3'); function shortcode_ibexrentacar_modelo($atts){ $atts['type'] = "modeldata"; $atts['model'] = $atts['modelo_id']; $atts['view'] = 1; if(isset($atts['locale'])){switch($atts['locale']){case 'en_EN': $atts['view'] = 2; break; default: break;}} return shortcode_ibexrentacar($atts);}add_shortcode('ibexrentacar-modelo','shortcode_ibexrentacar_modelo'); function shortcode_ibexrentacar_featured($atts){ $atts['type'] = "featured"; $atts['view'] = 1; if(isset($atts['locale'])){switch($atts['locale']){case 'en_EN': $atts['view'] = 2; break; default: break;}} return shortcode_ibexrentacar($atts);} add_shortcode('ibexrentacar-featured','shortcode_ibexrentacar_featured');/*END DEPRECATED SHORTCODES*/ ?>